<odoo>
  <data>

    <template id="rental_visit_template" name="Agendar visita portal">
      <t t-call="website.layout">
        <t t-set="title">Agendar visita</t>
        <t t-set="main_object" t-value="property or product"/>

        <div class="container my-5">
          <h1 class="h3 mb-4">Agendar visita</h1>

          <p class="mb-1">
            <strong>Producto:</strong>
            <t t-esc="product.name"/>
          </p>
          <p class="mb-4">
            <strong>Propiedad:</strong>
            <t t-esc="property and property.name or 'No vinculada'"/>
          </p>

          <!-- Mensajes -->
          <t t-if="message">
            <div class="alert alert-success" role="alert">
              <t t-esc="message"/>
            </div>
          </t>

          <t t-if="errors">
            <div class="alert alert-danger" role="alert">
              <ul class="mb-0">
                <t t-foreach="errors" t-as="err">
                  <li><t t-esc="err"/></li>
                </t>
              </ul>
            </div>
          </t>

          <!-- Formulario -->
          <form method="post">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

            <div class="row">
              <!-- Datos del cliente -->
              <div class="col-md-6 mb-4">
                <h2 class="h5 mb-3">Tus datos</h2>

                <t t-if="is_public">
                  <div class="mb-3">
                    <label class="form-label" for="name">Nombre completo</label>
                    <input type="text" name="name" id="name"
                           class="form-control"
                           t-att-value="form.get('name', '')"
                           required="required"/>
                  </div>

                  <div class="mb-3">
                    <label class="form-label" for="email">Correo electrónico</label>
                    <input type="email" name="email" id="email"
                           class="form-control"
                           t-att-value="form.get('email', '')"
                           required="required"/>
                  </div>

                  <div class="mb-3">
                    <label class="form-label" for="phone">Teléfono</label>
                    <input type="text" name="phone" id="phone"
                           class="form-control"
                           t-att-value="form.get('phone', '')"/>
                  </div>
                </t>
                <t t-else="">
                  <p>
                    Estás conectada como
                    <strong><t t-esc="request.env.user.partner_id.name"/></strong>.
                  </p>
                  <p class="text-muted">
                    Usaremos tus datos de contacto registrados en el sistema.
                  </p>
                </t>

                <div class="mb-3">
                  <label class="form-label" for="note">Notas adicionales (opcional)</label>
                  <textarea name="note" id="note"
                            class="form-control" rows="3">
                    <t t-esc="form.get('note', '')"/>
                  </textarea>
                </div>
              </div>

              <!-- Horario de visita -->
              <div class="col-md-6 mb-4">
                <h2 class="h5 mb-3">Horario de visita</h2>

                <t t-if="not slots">
                  <div class="alert alert-warning">
                    Actualmente no hay franjas horarias disponibles para esta propiedad.
                  </div>
                </t>
                <t t-else="">
                  <div class="mb-3">
                    <label class="form-label" for="slot_id">Franja disponible</label>
                    <select name="slot_id" id="slot_id"
                            class="form-control" required="required">
                      <option value="">Seleccioná una franja...</option>
                      <t t-foreach="slots" t-as="slot">
                        <option t-att-value="slot.id"
                                t-att-selected="str(slot.id) == str(form.get('slot_id', '')) and 'selected' or None">
                          <t t-esc="slot.name"/>
                        </option>
                      </t>
                    </select>
                    <small class="form-text text-muted">
                      Las franjas las define el agente (por ejemplo: 08:00–12:00).
                    </small>
                  </div>

                  <div class="row">
                    <div class="col-sm-6 mb-3">
                      <label class="form-label" for="visit_start_time">Hora de inicio</label>
                      <input type="time" name="visit_start_time" id="visit_start_time"
                             class="form-control" required="required"
                             t-att-value="form.get('visit_start_time', '')"/>
                    </div>
                    <div class="col-sm-6 mb-3">
                      <label class="form-label" for="visit_end_time">Hora de fin</label>
                      <input type="time" name="visit_end_time" id="visit_end_time"
                             class="form-control" required="required"
                             t-att-value="form.get('visit_end_time', '')"/>
                    </div>
                  </div>
                </t>
              </div>
            </div>

            <div class="mt-3">
              <button type="submit" class="btn btn-primary"
                      t-att-disabled="not slots and 'disabled' or None">
                Enviar solicitud de visita
              </button>
            </div>
          </form>
        </div>
      </t>
    </template>

  </data>
</odoo>
