<odoo>
    <data>
        <!-- LISTA -->
        <record id="view_rental_contract_list" model="ir.ui.view">
            <field name="name">rental.contract.list</field>
            <field name="model">rental.contract</field>
            <field name="arch" type="xml">
                <list>
                    <field name="name"/>
                    <field name="property_id"/>
                    <field name="tenant_id"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                    <field name="day_due"/>
                    <field name="rent_amount"/>
                    <field name="deposit_amount"/>
                    <field name="state"/>
                </list>
            </field>
        </record>

        <!-- FORM -->
        <record id="view_rental_contract_form" model="ir.ui.view">
            <field name="name">rental.contract.form</field>
            <field name="model">rental.contract</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <!-- Botón de impresión PDF -->
                        <button name="action_print_full_pdf"
                                type="object"
                                string="Imprimir ficha (PDF)"
                                class="oe_highlight"/>
                        <!-- botones existentes -->
                        <button name="action_activate" string="Activar" type="object"
                                invisible="state != 'draft'"/>
                        <button name="action_close" string="Cerrar" type="object"
                                invisible="state != 'active'"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,active,closed,cancel"/>

                        <button name="action_load_default_clauses"
                                type="object"
                                string="Cargar cláusulas por defecto"
                                class="btn-secondary"/>

                        <button name="action_add_clause_line"
                                type="object"
                                string="Agregar cláusula"
                                class="btn-link"/>

                        <button name="action_refresh_clauses"
                                type="object"
                                string="Refrescar cláusulas"
                                class="btn-secondary"
                                invisible="not clause_line_ids"/>

                    </header>
                    <sheet>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="property_id" required="1"/>
                            <field name="tenant_id" required="1"/>
                            <field name="agent_id"/>
                        </group>
                        <group>
                            <field name="start_date" required="1"/>
                            <field name="end_date"/>
                            <field name="day_due"/>
                        </group>
                        <group>
                            <field name="rent_amount"/>
                            <field name="deposit_amount"/>
                            <field name="penalty_amount"/>
                            <field name="currency_id" groups="base.group_no_one"/>
                        </group>
                        <notebook>
                            <page string="Facturas (Cliente)">
                                <field name="invoice_ids"
                                       context="{'default_rental_contract_id': id, 'default_rental_property_id': property_id}">
                                    <list>
                                        <field name="name"/>
                                        <field name="invoice_date"/>
                                        <field name="amount_total"/>
                                        <field name="state"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Adjuntos">
                                <field name="attachment_ids" widget="many2many_binary"/>
                            </page>

                            <!-- Vista de las clausulas -->
                            <page string="Cláusulas de contrato">
                                <field name="clause_line_ids" context="{'default_contract_id': id}">
                                    <list editable="bottom">
                                        <field name="selected"/>
                                        <field name="sequence"/>
                                        <field name="template_id"
                                               domain="[('active','=',True)]"
                                               options="{'no_create_edit': True}"/>
                                        <field name="title"/>
                                        <!-- columna de texto de la cláusula -->
                                        <field name="body_preview"
                                               readonly="1"
                                               optional="show"
                                               string="Texto (vista previa)"/>
                                    </list>

                                    <form string="Cláusula">
                                        <group>
                                            <group>
                                                <field name="selected"/>
                                                <field name="sequence"/>
                                            </group>
                                            <group>
                                                <field name="template_id"
                                                       domain="[('active','=',True)]"
                                                       options="{'no_create_edit': True}"/>
                                                <field name="title"/>
                                            </group>
                                        </group>
                                        <group string="Texto de la cláusula">
                                            <field name="body" widget="html"
                                                   readonly="not template_editable"/>
                                        </group>

                                    </form>
                                </field>
                            </page>

                        </notebook>
                        <notebook>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Acción -->
        <record id="action_rental_contract" model="ir.actions.act_window">
            <field name="name">Contratos</field>
            <field name="res_model">rental.contract</field>
            <field name="view_mode">list,form</field>
        </record>
    </data>
</odoo>
